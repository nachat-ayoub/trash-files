#!/bin/bash

# Function to find and delete node_modules directories
clean_node_modules() {
    local dir="$1"
    local found=0
    local deleted=0

    # Find all node_modules directories
    local node_modules_dirs=$(find "$dir" -type d -name "node_modules" -prune)
    
    if [ -z "$node_modules_dirs" ]; then
        echo "No node_modules directories found."
        return
    fi
    
    # Iterate over each node_modules directory
    for nm_dir in $node_modules_dirs; do
        found=$((found + 1))
        echo "Found: $nm_dir"
        
        # Attempt to delete the directory
        rm -rf "$nm_dir" && echo "Deleted: $nm_dir" && deleted=$((deleted + 1))
    done

    # Summary
    echo "--------------------------------------"
    echo "Summary:"
    echo "Total node_modules found: $found"
    echo "Total node_modules deleted: $deleted"
    echo "--------------------------------------"

    # Handle case where some directories couldn't be deleted
    if [ "$found" -ne "$deleted" ]; then
        echo "Some node_modules directories could not be deleted."
    fi
}

# Check if a directory is provided, else use the current directory
TARGET_DIR="${1:-.}"

# Call the function with the target directory
echo "Starting cleanup in $TARGET_DIR ..."
clean_node_modules "$TARGET_DIR"

echo "Cleanup complete."
